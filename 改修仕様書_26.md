# 改修仕様書 26

## フェーズ2.1 - バックエンドフレームワーク選定と基盤構築

### 改修の目的
データ永続化のための堅牢なバックエンドAPIを構築する基盤を整備

### 改修内容

#### 1. フレームワークの選定
Next.js API Routesの拡張を採用
- 理由: 既存のNext.js環境との統合が容易
- フルスタックアプリケーションとしての一貫性
- TypeScript対応が良好

#### 2. APIディレクトリ構造の整備
```
api/
├── auth/           # 認証関連API
├── users/          # ユーザー管理API
├── inventory/      # 在庫管理API
├── buyback/        # 買取申請API
├── sales/          # 販売管理API
├── antiquities/    # 古物台帳API
├── dashboard/      # ダッシュボードAPI
└── utils/          # 共通ユーティリティ
```

#### 3. 共通ミドルウェアの作成
```javascript
// api/utils/middleware.js
export const authMiddleware = (handler) => {
  return async (req, res) => {
    // JWT認証チェック
    // 権限確認
    // ログ記録
    return handler(req, res);
  };
};

export const errorHandler = (error, req, res, next) => {
  // エラーログ記録
  // 統一エラーレスポンス
};
```

#### 4. APIレスポンスフォーマットの統一
- 成功レスポンスの標準化
- エラーレスポンスの統一
- HTTPステータスコードの適切な使用

### 影響範囲
- `api/`ディレクトリ全体の再構築
- 新規: `api/utils/middleware.js`

### 所要時間
4-6時間

### 検証項目
- APIの基本構造が整備されること
- ミドルウェアが正常動作すること
- レスポンス形式が統一されること

### 次のステップ
改修仕様書_27: データベース選定と接続設定