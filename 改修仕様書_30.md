# 改修仕様書 30

## フェーズ2.5 - 初期データ投入スクリプト作成

### 改修の目的
開発・テスト・本番環境用の初期データを安全に投入するスクリプトを作成

### 改修内容

#### 1. 初期データ投入スクリプト
```javascript
// scripts/seedData.js
import bcrypt from 'bcryptjs';
import { query } from '../api/utils/database.js';

class DataSeeder {
  async seedUsers() {
    const users = [
      {
        email: 'admin@example.com',
        password: await bcrypt.hash('admin123', 10),
        role: 'admin',
        name: '管理者ユーザー'
      },
      {
        email: 'staff@example.com',
        password: await bcrypt.hash('staff123', 10),
        role: 'staff',
        name: 'スタッフユーザー'
      },
      {
        email: 'customer@example.com',
        password: await bcrypt.hash('customer123', 10),
        role: 'customer',
        name: 'カスタマーユーザー'
      }
    ];

    for (const user of users) {
      await query(`
        INSERT INTO users (email, password_hash, role, name)
        VALUES ($1, $2, $3, $4)
        ON CONFLICT (email) DO NOTHING
      `, [user.email, user.password, user.role, user.name]);
    }
  }

  async seedProducts() {
    const products = [
      {
        name: 'Nintendo Switch',
        category: 'ゲーム機',
        manufacturer: '任天堂',
        condition_grade: 'A',
        purchase_price: 25000,
        selling_price: 28000,
        stock_quantity: 5
      }
      // 他のサンプル商品
    ];

    for (const product of products) {
      await query(`
        INSERT INTO products (name, category, manufacturer, condition_grade, 
                             purchase_price, selling_price, stock_quantity)
        VALUES ($1, $2, $3, $4, $5, $6, $7)
      `, Object.values(product));
    }
  }

  async run(environment = 'development') {
    console.log(`Seeding data for ${environment} environment...`);
    
    if (environment !== 'production') {
      await this.seedUsers();
      await this.seedProducts();
    } else {
      // 本番環境では管理者ユーザーのみ
      await this.seedProductionAdmin();
    }
    
    console.log('Data seeding completed');
  }
}
```

#### 2. 環境別設定
```javascript
// scripts/environments.js
export const environments = {
  development: {
    seedTestData: true,
    createSampleUsers: true,
    populateProducts: true
  },
  staging: {
    seedTestData: true,
    createSampleUsers: false,
    populateProducts: false
  },
  production: {
    seedTestData: false,
    createSampleUsers: false,
    populateProducts: false
  }
};
```

#### 3. NPMスクリプトの追加
```json
{
  "scripts": {
    "db:seed": "node scripts/seedData.js development",
    "db:seed:staging": "node scripts/seedData.js staging",
    "db:seed:production": "node scripts/seedData.js production"
  }
}
```

#### 4. データ検証機能
- 投入データの整合性チェック
- 重複データの確認
- 必須データの存在確認

### 影響範囲
- 新規: `scripts/seedData.js`
- 新規: `scripts/environments.js`
- `package.json`

### 所要時間
2-3時間

### 検証項目
- 初期データが正常に投入されること
- 環境別の設定が適用されること
- 重複実行時の安全性が確保されること

### 次のステップ
改修仕様書_31: localStorageデータ移行ツール作成