# 改修仕様書 11

## フェーズ1.11 - 既存ユーザーパスワード移行準備

### 改修の目的
既存の平文パスワードを段階的にハッシュ化に移行する準備

### 改修内容

#### 1. パスワード移行ユーティリティの作成
```javascript
// src/utils/passwordMigration.js
export const needsMigration = (user) => {
  // パスワードがハッシュ化されているかチェック
  return !user.password.startsWith('$2a$');
}

export const migratePassword = async (user, plainPassword) => {
  if (needsMigration(user)) {
    return await hashPassword(plainPassword);
  }
  return user.password;
}
```

#### 2. 移行フラグの追加
- ユーザーデータに移行状態フラグを追加
- 移行済み・未移行の識別

#### 3. 互換性維持
- 既存の平文パスワードでのログインサポート
- 段階的移行のためのフォールバック機能

### 影響範囲
- 新規: `src/utils/passwordMigration.js`
- ユーザーデータ構造

### 所要時間
2-3時間

### 検証項目
- 移行判定が正確に動作すること
- 既存ユーザーのログインが継続できること
- 新規ユーザーは確実にハッシュ化されること

### 次のステップ
改修仕様書_12: ログイン時自動パスワード移行