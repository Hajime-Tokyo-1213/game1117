# 改修仕様書 12

## フェーズ1.12 - ログイン時自動パスワード移行

### 改修の目的
既存ユーザーがログインした際に自動的にパスワードをハッシュ化する

### 改修内容

#### 1. ログイン処理の拡張
```javascript
// AuthContext.jsx内のlogin関数
const login = async (email, password) => {
  const user = getStoredUser(email);
  
  if (needsMigration(user)) {
    // 平文パスワードで認証
    if (user.password === password) {
      // ハッシュ化して更新
      user.password = await hashPassword(password);
      updateStoredUser(user);
      return loginSuccess(user);
    }
  } else {
    // ハッシュ化パスワードで認証
    if (await verifyPassword(password, user.password)) {
      return loginSuccess(user);
    }
  }
  
  throw new Error('認証に失敗しました');
}
```

#### 2. 移行ログの実装
- 移行成功時のログ記録
- 移行進捗の追跡

#### 3. エラーハンドリング
- 移行失敗時の処理
- ロールバック機能

### 影響範囲
- `src/contexts/AuthContext.jsx`

### 所要時間
2-3時間

### 検証項目
- 平文パスワードユーザーのログインと自動移行
- ハッシュ化済みユーザーの通常ログイン
- 移行失敗時の適切な処理

### 次のステップ
改修仕様書_13: Loginコンポーネント更新