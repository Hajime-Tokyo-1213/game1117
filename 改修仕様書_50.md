# 改修仕様書 50

## フェーズ3.3 - APIクライアントのTypeScript化

### 改修の目的
APIクライアントに型安全性を導入し、開発効率を向上

### 改修内容

#### 型安全なAPIクライアント
```typescript
// src/utils/apiClient.ts
import { ApiResponse, PaginatedResponse } from '@/types/api';

export class ApiError extends Error {
  public status: number;
  public code: string;
  public details?: any;

  constructor(message: string, status: number = 500, code: string = 'API_ERROR', details?: any) {
    super(message);
    this.status = status;
    this.code = code;
    this.details = details;
    this.name = 'ApiError';
  }
}

interface RequestOptions extends RequestInit {
  headers?: Record<string, string>;
}

class ApiClient {
  private baseUrl: string;
  private token: string | null = null;

  constructor() {
    this.baseUrl = import.meta.env.PROD 
      ? 'https://your-domain.com' 
      : 'http://localhost:3000';
  }

  setAuthToken(token: string | null): void {
    this.token = token;
  }

  async request<T = any>(endpoint: string, options: RequestOptions = {}): Promise<T> {
    // 実装は既存と同じだが型安全に
  }

  async get<T = any>(endpoint: string, params?: Record<string, any>): Promise<T> {
    // 型安全な GET リクエスト
  }

  async post<T = any>(endpoint: string, body?: any): Promise<T> {
    // 型安全な POST リクエスト
  }

  async put<T = any>(endpoint: string, body?: any): Promise<T> {
    // 型安全な PUT リクエスト
  }

  async delete<T = any>(endpoint: string): Promise<T> {
    // 型安全な DELETE リクエスト
  }
}

export const apiClient = new ApiClient();
```

#### 認証クライアントの型化
```typescript
// src/utils/authClient.ts
import { User, AuthResponse } from '@/types/common';
import { LoginForm, RegisterForm } from '@/types/forms';

export const authClient = {
  async login(credentials: LoginForm): Promise<AuthResponse> {
    return apiClient.post<AuthResponse>('/auth/login', credentials);
  },

  async register(userData: RegisterForm): Promise<{ user: User; message: string }> {
    return apiClient.post('/auth/register', userData);
  },

  async logout(): Promise<void> {
    try {
      await apiClient.post('/auth/logout');
    } finally {
      apiClient.setAuthToken(null);
    }
  },

  async verifyToken(): Promise<{ valid: boolean; user?: User }> {
    return apiClient.get('/auth/verify');
  },

  async getProfile(): Promise<{ profile: User }> {
    return apiClient.get('/users/profile');
  },

  async updateProfile(profileData: Partial<User>): Promise<{ user: User }> {
    return apiClient.put('/users/profile', profileData);
  }
};
```

#### 在庫管理クライアントの型化
```typescript
// src/utils/inventoryClient.ts
import { Product } from '@/types/common';
import { ProductForm } from '@/types/forms';
import { PaginatedResponse } from '@/types/api';

interface InventoryParams {
  search?: string;
  category?: string;
  manufacturer?: string;
  condition_grade?: string;
  page?: number;
  limit?: number;
  sortBy?: string;
  sortOrder?: 'ASC' | 'DESC';
}

export const inventoryClient = {
  async getInventory(params: InventoryParams = {}): Promise<PaginatedResponse<Product>> {
    return apiClient.get('/inventory', params);
  },

  async getProduct(id: number): Promise<{ product: Product }> {
    return apiClient.get(`/inventory/${id}`);
  },

  async addProduct(productData: ProductForm): Promise<{ product: Product }> {
    return apiClient.post('/inventory', productData);
  },

  async updateProduct(id: number, productData: Partial<ProductForm>): Promise<{ product: Product }> {
    return apiClient.put(`/inventory/${id}`, productData);
  },

  async deleteProduct(id: number): Promise<{ message: string }> {
    return apiClient.delete(`/inventory/${id}`);
  }
};
```

### 影響範囲
- `src/utils/apiClient.js` → `src/utils/apiClient.ts`
- `src/utils/authClient.js` → `src/utils/authClient.ts`
- `src/utils/inventoryClient.js` → `src/utils/inventoryClient.ts`

### 所要時間
4-5時間

### 検証項目
- 型チェックが正常動作すること
- API呼び出しの型安全性が確保されること
- IDEの型サポートが機能すること

### 次のステップ
改修仕様書_51: ユーティリティ関数の共通化とコード重複削除